(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{604:function(e,r,t){Promise.resolve().then(t.bind(t,617)),Promise.resolve().then(t.t.bind(t,2445,23)),Promise.resolve().then(t.t.bind(t,6087,23))},617:function(e,r,t){"use strict";t.r(r),t.d(r,{ClientAuthProvider:function(){return d},useAuth:function(){return f}});var o=t(3827),l=t(4090),n=t(7176),u=t(7907);console.log("\uD83D\uDD0D DEBUG: ClientAuthProvider file loaded at:",new Date().toISOString());let D="https://hfrzxhbwjatdnpftrdgr.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhmcnp4aGJ3amF0ZG5wZnRyZGdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NTY3NzksImV4cCI6MjA2ODUzMjc3OX0.Fg7TK4FckPi5XAWNM_FLii9WyzSDAUCSdyoX-WLLXhA";a||(console.error("\uD83D\uDEA8 ERROR: NEXT_PUBLIC_SUPABASE_ANON_KEY not found in environment variables!"),console.error("\uD83D\uDD27 Please set NEXT_PUBLIC_SUPABASE_ANON_KEY in Vercel environment variables")),console.log("\uD83D\uDD0D DEBUG: Environment Variables Config:"),console.log("\uD83D\uDD0D DEBUG: - URL:",D),console.log("\uD83D\uDD0D DEBUG: - Key length:",a.length),console.log("\uD83D\uDD0D DEBUG: - Key starts with:",a.substring(0,20)),console.log("\uD83D\uDD0D DEBUG: - Using env vars:",!!a);let i=(0,n.eI)(D,a);console.log("\uD83D\uDD0D DEBUG: Supabase client created");let s=(0,l.createContext)(void 0),c=()=>{try{let e=localStorage.getItem("sb-hfrzxhbwjatdnpftrdgr-auth-token");return e?JSON.parse(e):null}catch(e){return null}};function d(e){let{children:r}=e,t=(0,u.useRouter)(),n=(0,u.usePathname)(),D=c();console.log("\uD83D\uDD0D DEBUG: Initial auth from storage:",!!D);let[a,d]=(0,l.useState)((null==D?void 0:D.user)||null),[f,g]=(0,l.useState)(null),[h,E]=(0,l.useState)(!D),m=async e=>{var r,t,o;console.log("\uD83D\uDD0D DEBUG: fetchUserProfile for",e);try{let{data:r,error:t}=await i.from("profiles").select("*").eq("id",e).maybeSingle();if(t)throw t;if(r)return r}catch(e){console.error("\uD83D\uDD0D DEBUG: Error fetching profile:",e)}return{id:e,email:(null==D?void 0:null===(r=D.user)||void 0===r?void 0:r.email)||"",full_name:(null==D?void 0:null===(o=D.user)||void 0===o?void 0:null===(t=o.user_metadata)||void 0===t?void 0:t.full_name)||"",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},U=async(e,r)=>{if(a)try{await i.from("user_activity_log").insert({user_id:a.id,activity_type:e,activity_data:r,ip_address:null,user_agent:navigator.userAgent})}catch(e){console.error("\uD83D\uDD0D DEBUG: Error logging activity:",e)}};(0,l.useEffect)(()=>{console.log("\uD83D\uDD0D DEBUG: AuthProvider mounted");let e=!0,r=setTimeout(()=>{e&&h&&(console.log("\uD83D\uDEA8 DEBUG: Loading timeout, forcing loading=false"),E(!1))},15e3);(async()=>{console.log("\uD83D\uDD0D DEBUG: getSession");try{let{data:{session:r},error:t}=await i.auth.getSession();if(t)throw t;if(null==r?void 0:r.user){d(r.user);let t=await m(r.user.id);if(!e)return;g(t)}else if(null==D?void 0:D.user){d(D.user);let r=await m(D.user.id);if(!e)return;g(r)}else localStorage.removeItem("sb-hfrzxhbwjatdnpftrdgr-auth-token"),d(null)}catch(e){console.error("\uD83D\uDD0D DEBUG: init error:",e)}finally{e&&E(!1),clearTimeout(r)}})();let{data:{subscription:o}}=i.auth.onAuthStateChange(async(o,l)=>{if(console.log("\uD83D\uDD0D DEBUG: onAuthStateChange",o),null==l?void 0:l.user){d(l.user);let r=await m(l.user.id);e&&g(r),"SIGNED_IN"===o&&"/dashboard"!==n&&t.push("/dashboard"),"SIGNED_IN"===o&&await U("login")}else d(null),g(null);e&&E(!1),clearTimeout(r)});return()=>{e=!1,o.unsubscribe(),clearTimeout(r)}},[t,n]);let _=async(e,r,t)=>{console.log("\uD83D\uDD0D DEBUG: signUp called for email:",e),E(!0);try{let{data:o,error:l}=await i.auth.signUp({email:e,password:r,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback"),data:{full_name:t||""}}});if(l)throw l;return console.log("\uD83D\uDD0D DEBUG: signUp successful:",o),{data:o,error:null}}catch(e){return console.error("\uD83D\uDD0D DEBUG: Sign up error:",e),{data:null,error:e.message}}finally{E(!1)}},y=async(e,r)=>{console.log("\uD83D\uDD0D DEBUG: signIn called for email:",e),E(!0);try{let{data:t,error:o}=await i.auth.signInWithPassword({email:e,password:r});if(o)throw o;return console.log("\uD83D\uDD0D DEBUG: signIn successful:",t),{data:t,error:null}}catch(e){return console.error("\uD83D\uDD0D DEBUG: Sign in error:",e),{data:null,error:e.message}}finally{E(!1)}},v=async()=>{console.log("\uD83D\uDD0D DEBUG: signOut called"),E(!0),a&&await U("logout");try{let{error:e}=await i.auth.signOut();if(e)throw e;console.log("\uD83D\uDD0D DEBUG: signOut successful")}catch(e){console.error("\uD83D\uDD0D DEBUG: signOut error:",e)}finally{d(null),g(null),E(!1)}},w=async e=>{if(console.log("\uD83D\uDD0D DEBUG: updateProfile called:",e),!a||!f)throw Error("No user logged in");E(!0);try{let{data:r,error:t}=await i.from("profiles").update({...e,updated_at:new Date().toISOString()}).eq("id",a.id).select().single();if(t)throw t;return g(r),await U("profile_update",e),console.log("\uD83D\uDD0D DEBUG: updateProfile successful:",r),{data:r,error:null}}catch(e){return console.error("\uD83D\uDD0D DEBUG: Update profile error:",e),{data:null,error:e.message}}finally{E(!1)}},G=async()=>{if(console.log("\uD83D\uDD0D DEBUG: refreshProfile called"),a)try{let e=await m(a.id);g(e),console.log("\uD83D\uDD0D DEBUG: Profile refreshed")}catch(e){console.error("\uD83D\uDD0D DEBUG: Error refreshing profile:",e)}},p=!!(null==a?void 0:a.email_confirmed_at);return(0,o.jsx)(s.Provider,{value:{user:a,userProfile:f,loading:h,isEmailVerified:p,signUp:_,signIn:y,signOut:v,updateProfile:w,refreshProfile:G,logActivity:U},children:r})}function f(){let e=(0,l.useContext)(s);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}r.default=d},2445:function(){},6087:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c"}}},function(e){e.O(0,[612,971,69,744],function(){return e(e.s=604)}),_N_E=e.O()}]);